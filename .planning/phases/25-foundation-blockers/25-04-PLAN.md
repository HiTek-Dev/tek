---
phase: 25-foundation-blockers
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/gateway/package.json
autonomous: true
gap_closure: true
requirements:
  - FOUND-01

must_haves:
  truths:
    - "pnpm turbo build completes in one pass with no circular dependency errors"
    - "pnpm test from repo root completes without turbo graph failures"
    - "Gateway auto-starts Telegram bot when run directly (runtime dynamic import still works)"
  artifacts:
    - path: "packages/gateway/package.json"
      provides: "Gateway dependencies without @tek/telegram"
      contains: "\"@tek/core\": \"workspace:*\""
  key_links:
    - from: "packages/gateway/src/index.ts"
      to: "@tek/telegram"
      via: "dynamic import (await import('@tek/telegram'))"
      pattern: "await import.*@tek/telegram"
---

<objective>
Break the @tek/gateway <-> @tek/telegram cyclic dependency that prevents `pnpm turbo build` from completing.

Purpose: The vault extraction in plan 25-01 broke the @tek/cli <-> @tek/gateway cycle, but unmasked a pre-existing @tek/gateway <-> @tek/telegram mutual dependency. Turbo cannot compute a valid build graph and fails immediately. This blocks both `pnpm turbo build` and `pnpm test` (which routes through turbo).

Output: Clean turbo build graph; both `pnpm turbo build` and `pnpm test` complete without cycle errors.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-foundation-blockers/25-VERIFICATION.md

Key findings from gap analysis:
- @tek/gateway lists @tek/telegram in package.json dependencies
- Gateway's ONLY use of @tek/telegram is a dynamic `await import("@tek/telegram")` inside a try/catch in index.ts (line 94) — used to auto-start the Telegram bot when the gateway is run directly
- There are ZERO static imports of @tek/telegram in any gateway source file
- @tek/telegram has legitimate static imports from @tek/gateway (Transport type, ServerMessage type, handleChatSend, initConnection, getConnectionState, recordSessionApproval, ChatSend type, ConnectionState type)
- The fix: remove @tek/telegram from gateway's package.json. Turbo uses package.json deps for its build graph. The dynamic import still resolves at runtime via pnpm workspace linking.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove @tek/telegram from gateway package.json and verify turbo build</name>
  <files>packages/gateway/package.json</files>
  <action>
Remove the `"@tek/telegram": "workspace:*"` line from packages/gateway/package.json dependencies.

Why this works:
- Gateway has ZERO static imports of @tek/telegram — only a dynamic `await import("@tek/telegram")` in index.ts line 94, wrapped in try/catch
- Turbo builds its dependency graph from package.json. Removing @tek/telegram from gateway's deps breaks the cycle at the turbo level
- The dynamic import resolves at runtime via pnpm workspace hoisting (all workspace packages are linked and accessible). Even in strict pnpm mode, dynamic imports in try/catch are a graceful degradation pattern
- @tek/telegram's dependency on @tek/gateway remains correct and unchanged (telegram legitimately uses gateway's exported types and functions)
- No source code changes needed in gateway or telegram

After editing package.json:
1. Run `pnpm install` to update the lockfile
2. Run `pnpm turbo build` — must complete with exit code 0 and no "Cyclic dependency detected" errors
3. Run `pnpm test` — must complete without turbo graph failures (may report no test files found, which is expected and correct)

Do NOT modify any TypeScript source files. Do NOT move types to @tek/core. The one-line package.json change is the complete fix.
  </action>
  <verify>
1. `grep -c "@tek/telegram" packages/gateway/package.json` returns 0
2. `pnpm turbo build` exits 0 with no cycle warnings
3. `pnpm test` exits without turbo graph errors
4. `grep -c "import.*@tek/telegram" packages/gateway/src/index.ts` returns 1 (dynamic import still present)
  </verify>
  <done>
- @tek/telegram removed from packages/gateway/package.json dependencies
- pnpm turbo build completes in one pass with no circular dependency errors
- pnpm test routes through turbo without graph failures
- Gateway source code unchanged — dynamic import of @tek/telegram still present for runtime bot auto-start
  </done>
</task>

</tasks>

<verification>
1. `pnpm turbo build` completes with exit code 0 — no "Cyclic dependency detected" message
2. `pnpm test` completes without turbo graph failures (test runner reaches vitest layer)
3. `grep "@tek/telegram" packages/gateway/package.json` returns no matches
4. `grep "import.*@tek/telegram" packages/gateway/src/index.ts` still shows the dynamic import (runtime behavior preserved)
5. `cat packages/telegram/package.json | grep "@tek/gateway"` still shows the dependency (telegram->gateway direction unchanged)
</verification>

<success_criteria>
- pnpm turbo build completes in one pass — FOUND-01 success criterion #1 fully satisfied
- pnpm test reaches vitest without turbo failures — FOUND-01 success criterion #4 unblocked
- No source code changes — zero regression risk to gateway or telegram functionality
</success_criteria>

<output>
After completion, create `.planning/phases/25-foundation-blockers/25-04-SUMMARY.md`
</output>
