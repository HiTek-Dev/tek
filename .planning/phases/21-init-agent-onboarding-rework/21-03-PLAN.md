---
phase: 21-init-agent-onboarding-rework
plan: 03
type: execute
wave: 3
depends_on: ["21-02"]
files_modified: []
autonomous: false
requirements:
  - "Full code review and CLI verification before desktop work"

must_haves:
  truths:
    - "tek init completes without asking for agent name or personality"
    - "tek onboard creates an agent visible in config.json"
    - "tek chat selects the onboarded agent and loads its identity"
    - "Legacy users with no agents list can still use tek chat"
  artifacts: []
  key_links: []
---

<objective>
End-to-end CLI verification of the full init -> onboard -> chat flow. Verify backward compatibility for legacy users without agents configured.

Purpose: Ensure the separation of concerns works correctly before any desktop work begins. Catch integration issues between init, onboard, and chat flows.

Output: Verified working CLI workflow.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-init-agent-onboarding-rework/21-01-SUMMARY.md
@.planning/phases/21-init-agent-onboarding-rework/21-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Verify full init -> onboard -> chat CLI flow</name>
  <what-built>
    Complete separation of tek init (app infrastructure only) from tek onboard (agent creation). Agent selection in tek chat with --agent flag and interactive picker. Per-session agentId in gateway WS protocol.
  </what-built>
  <how-to-verify>
    Build the project:
    ```
    cd /Users/hitekmedia/Documents/GitHub/tek
    npx tsc -p packages/core/tsconfig.json
    npx tsc -p packages/db/tsconfig.json
    npx tsc -p packages/gateway/tsconfig.json
    npx tsc -p packages/cli/tsconfig.json
    ```

    **Test 1: Verify tek init is slimmed**
    1. Run `tek init` (or re-run if already configured)
    2. Confirm it does NOT ask for agent name, personality preset, or workspace directory
    3. Confirm it ends with a message suggesting to run `tek onboard`

    **Test 2: Verify tek onboard creates an agent**
    1. Run `tek onboard`
    2. Walk through the wizard: enter agent name, pick a personality preset, optionally set model override, choose workspace scope, enter purpose
    3. Confirm it completes and the agent appears in `~/.config/tek/config.json` under `agents.list`
    4. Check that identity files exist in `~/.config/tek/agents/{agent-id}/`

    **Test 3: Verify tek chat selects agent**
    1. Start the gateway: `tek gateway start`
    2. Run `tek chat` — should auto-select the only agent
    3. Run `tek chat --agent {agent-id}` — should select that specific agent
    4. Send a message and verify the agent responds with its personality/identity

    **Test 4: Backward compatibility**
    1. Temporarily remove the `agents` section from config.json
    2. Run `tek chat` — should work in legacy mode without agent picker
    3. Restore the agents section
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
All 4 test scenarios pass as described in the checkpoint.
</verification>

<success_criteria>
- tek init → tek onboard → tek chat workflow functions end-to-end
- Agent identity loaded correctly in chat sessions
- Backward compatibility maintained for legacy configurations
</success_criteria>

<output>
After completion, create `.planning/phases/21-init-agent-onboarding-rework/21-03-SUMMARY.md`
</output>
