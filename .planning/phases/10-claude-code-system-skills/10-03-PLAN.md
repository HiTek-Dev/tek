---
phase: 10-claude-code-system-skills
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/gateway/src/skills/web-search.ts
  - packages/gateway/src/skills/image-gen.ts
  - packages/gateway/src/skills/browser.ts
  - packages/gateway/src/skills/index.ts
  - packages/gateway/src/agent/tool-registry.ts
autonomous: true

user_setup:
  - service: openai
    why: "Image generation via gpt-image-1.5"
    env_vars:
      - name: OPENAI_API_KEY
        source: "Already configured in AgentSpace vault from Phase 4 (multi-provider)"
  - service: search-provider
    why: "Web search API access (Tavily recommended)"
    env_vars:
      - name: TAVILY_API_KEY
        source: "Sign up at app.tavily.com -> API Keys"
    dashboard_config:
      - task: "Create free Tavily account for web search"
        location: "https://app.tavily.com"

must_haves:
  truths:
    - "Agent can perform web searches and return structured results"
    - "Agent can generate images from text prompts via OpenAI"
    - "Agent can automate browser tasks via Playwright MCP"
    - "System skills are registered in the tool registry alongside built-in tools"
  artifacts:
    - path: "packages/gateway/src/skills/web-search.ts"
      provides: "Web search AI SDK tool using Tavily API"
      exports: ["createWebSearchTool"]
    - path: "packages/gateway/src/skills/image-gen.ts"
      provides: "Image generation AI SDK tool using OpenAI gpt-image-1.5"
      exports: ["createImageGenTool"]
    - path: "packages/gateway/src/skills/browser.ts"
      provides: "Browser automation configuration for Playwright MCP"
      exports: ["getPlaywrightMcpConfig"]
    - path: "packages/gateway/src/skills/index.ts"
      provides: "Barrel exports for all system skills"
    - path: "packages/gateway/src/agent/tool-registry.ts"
      provides: "System skills integrated into buildToolRegistry"
      contains: "createWebSearchTool|createImageGenTool"
  key_links:
    - from: "packages/gateway/src/agent/tool-registry.ts"
      to: "packages/gateway/src/skills/index.ts"
      via: "import and register system skill tools"
      pattern: "import.*from.*skills"
    - from: "packages/gateway/src/skills/browser.ts"
      to: "packages/gateway/src/mcp/client-manager.ts"
      via: "Playwright MCP config consumed by existing MCPClientManager"
      pattern: "playwright"
---

<objective>
Implement three system skills (web search, image generation, browser automation) as AI SDK tools and integrate them into the existing tool registry. Playwright MCP plugs into the existing MCP infrastructure.

Purpose: Delivers SYST-04 (web search), SYST-05 (image generation), SYST-07 (browser automation) as agent-usable tools.

Output: `packages/gateway/src/skills/` module with three system skills registered in the tool registry.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-claude-code-system-skills/10-RESEARCH.md
@packages/gateway/src/agent/tool-registry.ts
@packages/gateway/src/mcp/client-manager.ts
@packages/gateway/src/mcp/config.ts
@packages/gateway/src/tools/filesystem.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Web search and image generation skills</name>
  <files>
    packages/gateway/src/skills/web-search.ts
    packages/gateway/src/skills/image-gen.ts
  </files>
  <action>
Install dependencies: `pnpm add openai --filter @agentspace/gateway` (if not already present from Phase 4's @ai-sdk/openai). No separate Tavily SDK needed -- use raw fetch.

Create `packages/gateway/src/skills/web-search.ts`:
- Import `tool` from "ai" and `z` from "zod"
- Export `createWebSearchTool(apiKey: string)` returning an AI SDK tool:
  - `description`: "Search the web for current information. Returns titles, URLs, and content snippets."
  - `inputSchema`: `z.object({ query: z.string().describe("Search query"), maxResults: z.number().optional().default(5) })`
  - `execute`: async function that calls Tavily Search API (`https://api.tavily.com/search`) via fetch:
    - POST with `{ api_key: apiKey, query, max_results: maxResults, include_answer: true }`
    - Return `{ answer: res.answer, results: res.results.map(r => ({ title: r.title, url: r.url, content: r.content })) }`
    - On error: return `{ error: "Search failed: " + message }` (graceful, no throw)
- If no apiKey provided, tool description notes it is unavailable

Create `packages/gateway/src/skills/image-gen.ts`:
- Import `tool` from "ai" and `z` from "zod"
- Import `OpenAI` from "openai"
- Export `createImageGenTool(apiKey: string)` returning an AI SDK tool:
  - `description`: "Generate an image from a text description using OpenAI's image generation model."
  - `inputSchema`: `z.object({ prompt: z.string().describe("Detailed description of the image to generate"), size: z.enum(["1024x1024", "1024x1792", "1792x1024"]).optional().default("1024x1024"), quality: z.enum(["low", "medium", "high"]).optional().default("medium") })`
  - `execute`: async function that:
    1. Creates `new OpenAI({ apiKey })`
    2. Calls `openai.images.generate({ model: "gpt-image-1.5", prompt, size, quality, n: 1 })`
    3. Returns `{ url: result.data[0].url, revisedPrompt: result.data[0].revised_prompt }` (url may be base64 data URL)
    4. On error: return `{ error: "Image generation failed: " + message }`
- Use `gpt-image-1.5` as default model (not deprecated DALL-E 3 per research Pitfall 3)
  </action>
  <verify>
Run `npx tsc --noEmit` from packages/gateway. Verify both tool factories compile and return AI SDK tool objects.
  </verify>
  <done>Web search tool calls Tavily API and returns structured search results. Image generation tool calls OpenAI gpt-image-1.5 and returns image URL. Both are AI SDK tool() definitions ready for registry.</done>
</task>

<task type="auto">
  <name>Task 2: Browser automation config and tool registry integration</name>
  <files>
    packages/gateway/src/skills/browser.ts
    packages/gateway/src/skills/index.ts
    packages/gateway/src/agent/tool-registry.ts
  </files>
  <action>
Create `packages/gateway/src/skills/browser.ts`:
- Export `getPlaywrightMcpConfig()` returning an MCP server config object:
  ```typescript
  { command: "npx", args: ["@playwright/mcp@latest", "--headless"] }
  ```
- This config is consumed by the existing MCPClientManager -- Playwright tools will be auto-namespaced as `playwright.browser_navigate`, `playwright.browser_click`, etc.
- Export `PLAYWRIGHT_SERVER_NAME = "playwright"` constant for config keying
- Note: No custom code needed for browser automation. Playwright MCP provides 25+ tools via existing MCP infrastructure. The config just needs to be added to mcpServers if the user enables browser automation.

Create `packages/gateway/src/skills/index.ts`:
- Barrel export all: `createWebSearchTool`, `createImageGenTool`, `getPlaywrightMcpConfig`, `PLAYWRIGHT_SERVER_NAME`

Update `packages/gateway/src/agent/tool-registry.ts`:
- Import system skill factories from `../skills/index.js`
- Add `ToolRegistryOptions` fields: `tavilyApiKey?: string`, `openaiApiKey?: string`
- After existing tool registration (step 4 skill tools), add step 5:
  - If `tavilyApiKey` provided: create web search tool via `createWebSearchTool(tavilyApiKey)`, add to tools map as `"web_search"`, apply approval wrapper (use "auto" tier -- search is read-only)
  - If `openaiApiKey` provided: create image gen tool via `createImageGenTool(openaiApiKey)`, add to tools map as `"image_generate"`, apply approval wrapper (use "session" tier -- costs money)
- Playwright browser tools are already handled by the MCP tool loading loop (step 3) if "playwright" is in mcpConfigs. No special code needed -- just document that adding `{ playwright: getPlaywrightMcpConfig() }` to mcpServers config enables browser automation.
- Log how many system skills were registered
  </action>
  <verify>
Run `npx tsc --noEmit` from packages/gateway. Verify tool-registry.ts imports from skills and conditionally registers web_search and image_generate tools.
  </verify>
  <done>System skills (web search, image gen) are conditionally registered in the tool registry based on API key availability. Playwright browser automation works through existing MCP config with zero custom code. All three system skills are available as agent tools.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in packages/gateway
2. `packages/gateway/src/skills/` exists with web-search.ts, image-gen.ts, browser.ts, index.ts
3. Tool registry conditionally includes `web_search` and `image_generate` when API keys are configured
4. Playwright MCP config matches expected format for MCPClientManager
5. Image gen uses `gpt-image-1.5` (not deprecated DALL-E 3)
</verification>

<success_criteria>
- Web search tool accepts query and returns structured results from Tavily API
- Image generation tool accepts prompt and returns image URL from OpenAI gpt-image-1.5
- Browser automation available via Playwright MCP through existing MCP infrastructure
- All system skills registered in tool registry with appropriate approval tiers
</success_criteria>

<output>
After completion, create `.planning/phases/10-claude-code-system-skills/10-03-SUMMARY.md`
</output>
