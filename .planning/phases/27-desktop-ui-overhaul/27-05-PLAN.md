---
phase: 27-desktop-ui-overhaul
plan: 05
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - apps/desktop/src/pages/DashboardPage.tsx
  - apps/desktop/src/pages/SettingsPage.tsx
autonomous: true
requirements:
  - DSKV-11
  - DSKV-12

must_haves:
  truths:
    - "Dashboard shows usage stats cards (total cost, total tokens, request count) fetched from gateway"
    - "Dashboard shows recent sessions list (top 5 with model and message count)"
    - "Dashboard shows gateway status and system health indicators"
    - "Dashboard shows a Memory status indicator (Active when gateway running, Inactive otherwise)"
    - "Settings page is organized into tabbed sections (General, Providers, Model Aliases, MCP Servers, Gateway Info)"
    - "Provider section shows configured/health status indicators"
  artifacts:
    - path: "apps/desktop/src/pages/DashboardPage.tsx"
      provides: "Enriched dashboard with usage stats, recent sessions, system health"
    - path: "apps/desktop/src/pages/SettingsPage.tsx"
      provides: "Tabbed settings page with organized sections"
  key_links:
    - from: "apps/desktop/src/pages/DashboardPage.tsx"
      to: "apps/desktop/src/lib/gateway-client.ts"
      via: "createUsageQueryMessage and createSessionListMessage on mount"
      pattern: "createUsageQueryMessage|createSessionListMessage"
    - from: "apps/desktop/src/pages/SettingsPage.tsx"
      to: "apps/desktop/src/components/ui/Tabs.tsx"
      via: "Tabs component for section navigation"
      pattern: "Tabs"
---

<objective>
Enrich Dashboard with usage stats and recent sessions, reorganize Settings into tabbed layout.

Purpose: The dashboard currently shows only gateway status and quick actions. The settings page is a single long scroll. This plan adds real data (usage, sessions, health) to the dashboard and organizes settings into scannable tabbed sections.
Output: Enriched DashboardPage with stats cards and session list, tabbed SettingsPage.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-desktop-ui-overhaul/27-RESEARCH.md
@.planning/phases/27-desktop-ui-overhaul/27-01-SUMMARY.md
@apps/desktop/src/pages/DashboardPage.tsx
@apps/desktop/src/pages/SettingsPage.tsx
@apps/desktop/src/components/ui/Tabs.tsx
@apps/desktop/src/lib/gateway-client.ts
@apps/desktop/src/hooks/useGateway.ts
@apps/desktop/src/hooks/useWebSocket.ts
@apps/desktop/src/hooks/useConfig.ts
@apps/desktop/src/stores/app-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enrich DashboardPage with usage stats, recent sessions, and health indicators</name>
  <files>apps/desktop/src/pages/DashboardPage.tsx</files>
  <action>
Rewrite DashboardPage to show three sections below the gateway status:

**1. Usage Stats Cards (3-column grid):**
- Create a WebSocket connection to the gateway (same pattern as ChatPage: construct wsUrl from gateway.port, use useWebSocket).
- On mount when connected, send `createUsageQueryMessage()` and `createSessionListMessage()`.
- Listen for `usage.report` message: extract `grandTotal.totalCost`, `grandTotal.totalTokens`, `grandTotal.requestCount`.
- Display three stats cards in a grid:
  - "Total Cost": format as `$X.XX`, icon: dollar sign, `bg-surface-secondary border border-surface-overlay rounded-xl p-4`
  - "Total Tokens": format with locale string (e.g., "12,345"), icon: hash
  - "Requests": format as integer, icon: arrow-up-right
- While loading, show Skeleton components in card positions
- If not connected, show cards with "--" values and muted styling

**2. Recent Sessions (below stats):**
- Listen for `session.list.response` (or `session.list` — check the type string from gateway protocol). Extract sessions array.
- Show top 5 sessions in a list with:
  - Session key or truncated ID
  - Model name (Badge variant="brand")
  - Message count
  - Relative time (same timeAgo helper as SessionList — can duplicate the small helper)
- "View all" link that navigates to chat page
- While loading, show 3 Skeleton rows

**3. System Health:**
- Keep existing GatewayStatus component
- Add a "Memory" indicator: show "Active" badge if gateway is running (we don't have a memory stats endpoint, so just show status based on gateway running state per research recommendation)
- Add "Providers" summary: show count from `config.configuredProviders` with a green badge

Update all colors to use design tokens. Replace hardcoded `bg-gray-800` with `bg-surface-secondary`, `text-gray-400` with `text-text-secondary`, etc.

**WebSocket approach for Dashboard:** Since Dashboard needs a WS connection for usage/session queries, create the connection inline (same pattern as ChatPage). The connection is lightweight and the gateway handles multiple connections.
  </action>
  <verify>
Run `pnpm build` from apps/desktop. Verify DashboardPage imports createUsageQueryMessage and createSessionListMessage. Check that Skeleton is used for loading states.
  </verify>
  <done>
Dashboard displays usage stats cards, recent sessions list, and system health indicators. All data fetched from gateway via WebSocket. Loading states use Skeleton components. Colors use design tokens.
  </done>
</task>

<task type="auto">
  <name>Task 2: Reorganize SettingsPage into tabbed sections with provider health</name>
  <files>apps/desktop/src/pages/SettingsPage.tsx</files>
  <action>
Refactor SettingsPage to use Tabs component for section navigation:

1. Import `Tabs` from `../components/ui/Tabs` and `Badge` from `../components/ui/Badge`
2. Define tabs: `[{ id: "general", label: "General" }, { id: "providers", label: "Providers" }, { id: "aliases", label: "Model Aliases" }, { id: "mcp", label: "MCP Servers" }, { id: "gateway", label: "Gateway Info" }]`
3. Add `activeTab` state (default "general")
4. Render `<Tabs>` at top of settings content area
5. Conditionally render only the active tab's content (keep existing ConfigSection content, just move each section into its tab):

**General tab:** Default model input, security mode display, workspace directory. Same as current "General" ConfigSection content.

**Providers tab:** Same as current "Providers" section but add health indicators:
- For each provider, show a Badge: `variant="success"` with text "Configured"
- Add explanatory text: "Provider health is determined by key configuration status"
- Keep the "API keys managed via CLI" note

**Model Aliases tab:** Same as current "Model Aliases" section (add/remove alias UI)

**MCP Servers tab:** Same as current "MCP Servers" section

**Gateway Info tab:** Same as current "Gateway Info" section

6. Move the Save/Reload footer OUTSIDE the tab content so it's always visible at the bottom regardless of active tab
7. Update all colors to design tokens: replace `bg-gray-800` with `bg-surface-secondary`, `text-gray-400` with `text-text-secondary`, `bg-gray-900` with `bg-surface-primary`, `border-gray-700` with `border-surface-overlay`, `bg-blue-600` with `bg-brand-600`, `hover:bg-blue-500` with `hover:bg-brand-500`, etc.
8. Remove the ConfigSection wrapper since Tabs now provides section separation. Or keep ConfigSection for sub-grouping within a tab if needed.
  </action>
  <verify>
Run `pnpm build` from apps/desktop. Verify SettingsPage imports and renders Tabs component. Confirm all 5 tab IDs are defined.
  </verify>
  <done>
Settings page organized into 5 tabbed sections. Provider health indicators show configured status. Save/Reload always visible. All colors use design tokens.
  </done>
</task>

</tasks>

<verification>
- `pnpm build` in apps/desktop succeeds
- DashboardPage shows usage stats, recent sessions, and health indicators
- DashboardPage uses Skeleton for loading states
- SettingsPage uses Tabs component with 5 sections
- Providers section shows health badges
- All colors use design tokens (no hardcoded blue-600, gray-800, etc.)
</verification>

<success_criteria>
Dashboard shows usage stats (cost, tokens, requests), recent sessions (top 5), and system health. Settings page is organized with tabs for General, Providers, Model Aliases, MCP Servers, and Gateway Info. Provider health indicators display configured status.
</success_criteria>

<output>
After completion, create `.planning/phases/27-desktop-ui-overhaul/27-05-SUMMARY.md`
</output>
