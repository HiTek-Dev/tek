---
phase: 15-init-onboarding-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/cli/src/components/Onboarding.tsx
autonomous: true
requirements:
  - ONBOARD-ALIAS

must_haves:
  truths:
    - "User selects which models to alias via MultiSelect checkboxes instead of iterating through every model"
    - "TextInput clears between alias name entries (no pre-filled previous value)"
    - "User can skip aliasing entirely by pressing Enter with none selected"
    - "Existing aliases can be preserved via keep option when re-running setup"
  artifacts:
    - path: "packages/cli/src/components/Onboarding.tsx"
      provides: "MultiSelect-based model alias flow with TextInput key fix"
      contains: "MultiSelect"
  key_links:
    - from: "packages/cli/src/components/Onboarding.tsx"
      to: "@inkjs/ui"
      via: "MultiSelect import"
      pattern: "import.*MultiSelect.*@inkjs/ui"
---

<objective>
Replace the sequential one-by-one model alias assignment with a MultiSelect checkbox step, and fix the TextInput clearing bug between alias entries.

Purpose: The current alias flow iterates through every model asking for an alias via TextInput. This is tedious (20+ models) and the TextInput retains the previous value. MultiSelect lets users pick just the models they want to alias, then name only those.
Output: Refactored Onboarding.tsx with MultiSelect-based alias flow.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@packages/cli/src/components/Onboarding.tsx
@.planning/phases/15-init-onboarding-polish/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace model alias step with MultiSelect + keyed TextInput</name>
  <files>packages/cli/src/components/Onboarding.tsx</files>
  <action>
1. Add MultiSelect to the import from @inkjs/ui:
   ```typescript
   import { Select, TextInput, ConfirmInput, MultiSelect } from "@inkjs/ui";
   ```

2. Split the "model-alias" step into two steps in the OnboardingStep type:
   - `"model-alias-select"` — MultiSelect checkboxes to pick which models to alias
   - `"model-alias-name"` — TextInput for naming each selected model (sequential, but only for selected ones)

   Add these to the OnboardingStep union type, replacing `"model-alias"`.

3. Add state for models selected for aliasing:
   ```typescript
   const [modelsToAlias, setModelsToAlias] = useState<string[]>([]);
   ```

4. In the "model-select" step's onChange handler, change `setStep("model-alias")` to `setStep("model-alias-select")`.

5. Implement the "model-alias-select" step:
   - If existingConfig?.modelAliases exists and has entries, show a ConfirmInput first: "Keep existing aliases? (alias1 -> model1, ...)" with yes going to summary and no falling through to MultiSelect.
   - Actually, simpler: show a Select with "Keep existing aliases" option (if applicable), then the MultiSelect. But to avoid complexity, use this approach:
     - If existingConfig?.modelAliases has entries, render a Select with options: "Keep current aliases", "Choose new aliases", "Skip aliases". On "keep" -> preserve and go to summary. On "choose" -> show MultiSelect. On "skip" -> go to summary.
     - If no existing aliases, go straight to MultiSelect.
   - MultiSelect renders all availableModels. Set `visibleOptionCount={8}`. Add hint text: "Space to toggle, Enter to confirm. Enter with none selected to skip."
   - onSubmit: if empty array, go to summary. Otherwise, set modelsToAlias to the selected values, set aliasIndex to 0, go to "model-alias-name".

6. Implement the "model-alias-name" step:
   - Guard: if aliasIndex >= modelsToAlias.length, go to summary, return null.
   - Find the model label from availableModels for the current modelsToAlias[aliasIndex].
   - Render TextInput with a KEY PROP to force remount on each alias: `key={\`alias-\${aliasIndex}\`}`. This is the critical fix for the TextInput clearing bug.
   - Show "Assign alias for {model label}:" prompt.
   - Show current aliases so far below the prompt (dimColor).
   - onSubmit: if value is trimmed and non-empty, add to modelAliases. Increment aliasIndex.
   - No "done" or "keep" keywords needed — the MultiSelect already filtered to only selected models.

7. Remove the old "model-alias" step implementation entirely.

CRITICAL: The TextInput key prop fix (`key={\`alias-\${aliasIndex}\`}`) forces React to unmount and remount TextInput when aliasIndex changes, ensuring the internal input state resets. This is the established React pattern for resetting uncontrolled component state.
  </action>
  <verify>
    Run `cd /Users/hitekmedia/Documents/GitHub/tek && npx tsc --noEmit -p packages/cli/tsconfig.json` — must pass with zero errors.
  </verify>
  <done>
    Model alias flow uses MultiSelect for selection + keyed TextInput for naming. TextInput clears between entries. Existing aliases can be kept. Empty selection skips aliasing. TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit -p packages/cli/tsconfig.json` passes
2. Onboarding.tsx imports MultiSelect from @inkjs/ui
3. OnboardingStep type includes "model-alias-select" and "model-alias-name"
4. TextInput in alias-name step has `key` prop tied to aliasIndex
5. Old "model-alias" step is removed
</verification>

<success_criteria>
- MultiSelect replaces one-by-one model alias iteration
- TextInput properly clears between alias entries via key prop
- Existing alias preservation ("keep") still works
- TypeScript compiles with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/15-init-onboarding-polish/15-02-SUMMARY.md`
</output>
