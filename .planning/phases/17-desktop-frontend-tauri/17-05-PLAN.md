---
phase: 17-desktop-frontend-tauri
plan: 05
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - apps/desktop/src/lib/config.ts
  - apps/desktop/src/hooks/useConfig.ts
  - apps/desktop/src/pages/SettingsPage.tsx
  - apps/desktop/src/components/ConfigSection.tsx
autonomous: true
requirements:
  - DESK-05

must_haves:
  truths:
    - "User can view current configuration (model, providers, security mode)"
    - "User can edit settings and save them to config.json"
    - "Settings load from ~/.config/tek/config.json on page open"
    - "Gateway connection info is displayed in settings"
  artifacts:
    - path: "apps/desktop/src/lib/config.ts"
      provides: "Config file read/write via Tauri FS plugin"
    - path: "apps/desktop/src/hooks/useConfig.ts"
      provides: "React hook for config state management"
    - path: "apps/desktop/src/pages/SettingsPage.tsx"
      provides: "Settings and configuration management page"
  key_links:
    - from: "apps/desktop/src/lib/config.ts"
      to: "$HOME/.config/tek/config.json"
      via: "Tauri FS plugin readTextFile/writeTextFile"
      pattern: "readTextFile.*config\\.json"
    - from: "apps/desktop/src/pages/SettingsPage.tsx"
      to: "apps/desktop/src/hooks/useConfig.ts"
      via: "Hook providing config state and save"
      pattern: "useConfig"
---

<objective>
Build the Settings page for viewing and editing app configuration (model, providers, security mode) with read/write to config.json.

Purpose: Users can inspect and modify configuration without editing JSON files or using CLI commands.
Output: SettingsPage with grouped configuration sections and save functionality.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-desktop-frontend-tauri/17-RESEARCH.md
@.planning/phases/17-desktop-frontend-tauri/17-01-SUMMARY.md
@packages/core/src/config/types.ts
@packages/core/src/config/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Config read/write module and settings hook</name>
  <files>
    apps/desktop/src/lib/config.ts
    apps/desktop/src/hooks/useConfig.ts
  </files>
  <action>
    **src/lib/config.ts:** Configuration file management via Tauri FS plugin.

    Export `async function loadConfig(): Promise<AppConfig | null>` that:
    1. Constructs path: `${homeDir()}/.config/tek/config.json`
    2. Checks exists, returns null if not
    3. Reads with readTextFile, parses JSON
    4. Returns parsed config object

    Export `async function saveConfig(config: AppConfig): Promise<void>` that:
    1. Ensures config dir exists
    2. JSON.stringify with 2-space indent
    3. Writes to config.json

    Define `AppConfig` type locally (simplified from @tek/core -- just what the UI needs):
    ```typescript
    interface AppConfig {
      securityMode?: 'full' | 'limited';
      workspaceDir?: string;
      defaultModel?: string;
      modelAliases?: Record<string, string>;
      configuredProviders?: string[];
      mcpServers?: Record<string, { command: string; args?: string[] }>;
      [key: string]: unknown; // Preserve unknown fields
    }
    ```

    Important: When saving, merge edits with existing config (don't lose fields the UI doesn't know about). Load full JSON, spread updates, save back.

    **src/hooks/useConfig.ts:** React hook for config state.

    Export `function useConfig()` that:
    1. State: `config: AppConfig | null`, `loading: boolean`, `error: string | null`, `modified: boolean`
    2. On mount, calls loadConfig()
    3. Provides `updateField(key: string, value: unknown)` -- updates local state, sets modified=true
    4. Provides `save()` -- calls saveConfig with current state, clears modified
    5. Provides `reload()` -- re-reads from disk
    6. Returns `{ config, loading, error, modified, updateField, save, reload }`
  </action>
  <verify>
    - `cat apps/desktop/src/lib/config.ts` reads/writes config.json via Tauri FS
    - `cat apps/desktop/src/hooks/useConfig.ts` manages config state with save/reload
    - Unknown config fields preserved on save (spread pattern)
  </verify>
  <done>Config module reads/writes config.json preserving unknown fields, hook provides state management</done>
</task>

<task type="auto">
  <name>Task 2: Settings page with configuration sections</name>
  <files>
    apps/desktop/src/pages/SettingsPage.tsx
    apps/desktop/src/components/ConfigSection.tsx
  </files>
  <action>
    **src/components/ConfigSection.tsx:** Reusable settings section component.

    Props: `{ title: string; description?: string; children: ReactNode }`.
    Renders a card-like section: bg-gray-800 rounded-lg p-6, title in font-semibold, description in text-gray-400, children below. Sections are visually separated with margin-bottom.

    **src/pages/SettingsPage.tsx:** Replace stub with settings interface.

    Use useConfig hook. Layout with sections:

    **1. General section:**
    - Default model: text input showing current defaultModel value, editable
    - Security mode: display current mode (full/limited) as a read-only badge (changing security mode should go through CLI for safety)
    - Workspace directory: display path if in limited mode

    **2. Providers section:**
    - List of configured providers as badges (e.g., "anthropic", "openai", "ollama")
    - Note: "API keys are managed securely via the CLI. Run `tek keys` to manage."
    - Provider count shown

    **3. Model Aliases section:**
    - Table/list of alias -> model mappings
    - Each row shows alias name and target model
    - Add alias: text input for name + text input for model
    - Remove alias: X button per row
    - Note: changes apply on save

    **4. MCP Servers section:**
    - List of configured MCP server names
    - Each shows command and args
    - Read-only display (MCP config is complex, editing via CLI is safer)
    - "No MCP servers configured" empty state

    **5. Gateway Info section:**
    - Display gateway status from Zustand store (reuse from DashboardPage context)
    - Config file path shown: `~/.config/tek/config.json`
    - Database path: `~/.config/tek/tek.db`

    **Footer:** Save button (prominent when modified), Reload button, "Changes saved" confirmation text.

    Handle loading state (skeleton/spinner), error state (red alert banner), and empty config state (show defaults).
  </action>
  <verify>
    - `pnpm tauri dev`, navigate to Settings page
    - Current config values display correctly
    - Editing default model marks as modified
    - Save button writes changes to config.json
    - Model aliases can be added and removed
    - Provider list displays correctly
  </verify>
  <done>Settings page displays grouped configuration with editable fields, alias management, and save/reload functionality</done>
</task>

</tasks>

<verification>
- Config loads from ~/.config/tek/config.json on page open
- Editing and saving updates the config file (verify with `cat ~/.config/tek/config.json`)
- Unknown config fields are preserved when saving
- Model aliases can be added, removed, and persisted
- Read-only fields (security mode, MCP servers) display but aren't editable
- Loading and error states handled gracefully
</verification>

<success_criteria>
Users can view all configuration settings, edit the default model, manage model aliases, and save changes to config.json. Configuration is displayed in organized sections with appropriate read-only/editable fields.
</success_criteria>

<output>
After completion, create `.planning/phases/17-desktop-frontend-tauri/17-05-SUMMARY.md`
</output>
