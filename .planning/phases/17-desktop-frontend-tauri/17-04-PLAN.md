---
phase: 17-desktop-frontend-tauri
plan: 04
type: execute
wave: 2
depends_on: ["17-01"]
files_modified:
  - apps/desktop/src/lib/files.ts
  - apps/desktop/src/hooks/useIdentityFiles.ts
  - apps/desktop/src/pages/AgentsPage.tsx
  - apps/desktop/src/components/FileEditor.tsx
autonomous: true
requirements:
  - DESK-04

must_haves:
  truths:
    - "User can view agent identity files (SOUL.md, IDENTITY.md, USER.md, STYLE.md)"
    - "User can edit identity file content and save changes"
    - "File changes persist to disk at ~/.config/tek/"
    - "Files load from the filesystem on page open"
  artifacts:
    - path: "apps/desktop/src/lib/files.ts"
      provides: "Identity file read/write via Tauri FS plugin"
    - path: "apps/desktop/src/hooks/useIdentityFiles.ts"
      provides: "React hook for loading and saving identity files"
    - path: "apps/desktop/src/pages/AgentsPage.tsx"
      provides: "Agent identity file management page"
    - path: "apps/desktop/src/components/FileEditor.tsx"
      provides: "Markdown file editor component with save"
  key_links:
    - from: "apps/desktop/src/lib/files.ts"
      to: "$HOME/.config/tek/"
      via: "Tauri FS plugin readTextFile/writeTextFile"
      pattern: "readTextFile|writeTextFile"
    - from: "apps/desktop/src/hooks/useIdentityFiles.ts"
      to: "apps/desktop/src/lib/files.ts"
      via: "loadFile/saveFile calls"
      pattern: "loadIdentityFile|saveIdentityFile"
---

<objective>
Build the Agents page for viewing and editing agent identity files (SOUL.md, IDENTITY.md, USER.md, STYLE.md) through a tabbed file editor interface.

Purpose: Users can manage their agent's personality and identity files through a GUI instead of manually editing markdown files.
Output: AgentsPage with tabbed file viewer/editor and save functionality.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-desktop-frontend-tauri/17-RESEARCH.md
@.planning/phases/17-desktop-frontend-tauri/17-01-SUMMARY.md
@packages/core/src/config/constants.ts
@packages/core/src/config/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: File system utilities and identity file hook</name>
  <files>
    apps/desktop/src/lib/files.ts
    apps/desktop/src/hooks/useIdentityFiles.ts
  </files>
  <action>
    **src/lib/files.ts:** File read/write utilities using Tauri FS plugin.

    ```
    import { readTextFile, writeTextFile, exists, mkdir } from '@tauri-apps/plugin-fs';
    import { homeDir, join } from '@tauri-apps/api/path';
    ```

    Constants: `IDENTITY_FILES` array of `{ name: string; filename: string; description: string }`:
    - `{ name: 'Soul', filename: 'SOUL.md', description: 'Core personality and values' }`
    - `{ name: 'Identity', filename: 'IDENTITY.md', description: 'Background, expertise, communication style' }`
    - `{ name: 'User', filename: 'USER.md', description: 'Information about the user' }`
    - `{ name: 'Style', filename: 'STYLE.md', description: 'Tone, humor, formatting preferences' }`

    Export `async function getConfigDir(): Promise<string>` that returns `${homeDir()}/.config/tek`.

    Export `async function loadIdentityFile(filename: string): Promise<string | null>` that:
    1. Constructs full path: `${configDir}/${filename}`
    2. Checks exists, returns null if not
    3. Reads and returns content

    Export `async function saveIdentityFile(filename: string, content: string): Promise<void>` that:
    1. Ensures config dir exists (mkdir if needed)
    2. Writes content to `${configDir}/${filename}`

    **src/hooks/useIdentityFiles.ts:** React hook for managing identity files.

    Export `function useIdentityFiles()` that:
    1. State: `files: Map<string, { content: string | null; modified: boolean; loading: boolean }>`, `activeFile: string` (defaults to 'SOUL.md')
    2. On mount, loads all identity files in parallel
    3. Provides `setContent(filename: string, content: string)` -- marks file as modified
    4. Provides `save(filename: string)` -- writes to disk, clears modified flag
    5. Provides `saveAll()` -- saves all modified files
    6. Provides `reload(filename?: string)` -- re-reads from disk
    7. Returns `{ files, activeFile, setActiveFile, setContent, save, saveAll, reload }`
  </action>
  <verify>
    - `cat apps/desktop/src/lib/files.ts` uses Tauri FS plugin for file ops
    - `cat apps/desktop/src/hooks/useIdentityFiles.ts` manages state for 4 identity files
    - No Node.js fs imports
  </verify>
  <done>File utilities read/write identity files via Tauri FS, hook manages loading/editing/saving state</done>
</task>

<task type="auto">
  <name>Task 2: Agents page with tabbed file editor</name>
  <files>
    apps/desktop/src/pages/AgentsPage.tsx
    apps/desktop/src/components/FileEditor.tsx
  </files>
  <action>
    **src/components/FileEditor.tsx:** A markdown text editor component.

    Props: `{ content: string; onChange: (content: string) => void; modified: boolean; onSave: () => void; loading: boolean; readOnly?: boolean }`.

    Renders:
    - Full-height textarea with monospace font (font-mono), dark bg (bg-gray-900), light text
    - Textarea fills available space (flex-grow)
    - Save button in top-right corner, highlighted when modified (blue-500 bg when dirty, gray when clean)
    - Keyboard shortcut: Cmd+S (or Ctrl+S) triggers onSave
    - "Unsaved changes" indicator when modified (yellow dot or text)
    - Loading skeleton while file is loading
    - Line numbers gutter on the left (optional -- implement if straightforward, skip if complex)

    Style: Clean, minimal editor look. No rich markdown preview for now -- plain text editing is sufficient for MVP.

    **src/pages/AgentsPage.tsx:** Replace stub with tabbed identity file manager.

    Layout:
    - Header: "Agent Identity" with brief subtitle "Manage your agent's personality and identity files"
    - Tab bar with tabs for each identity file (Soul, Identity, User, Style)
    - Active tab highlighted with accent color, underline indicator
    - Each tab shows the file's description in a tooltip or subtitle
    - FileEditor component showing the active file's content
    - "File not found" state: show message "This file hasn't been created yet" with a "Create" button that initializes with a template comment
    - Footer bar: "Save All" button (if any files modified), file path shown in small text

    Use useIdentityFiles hook for all state management. Wire tab switches to setActiveFile.
  </action>
  <verify>
    - `pnpm tauri dev`, navigate to Agents page
    - Tab bar shows 4 identity files
    - Clicking a tab loads and displays the file content
    - Editing text marks the file as modified (unsaved indicator)
    - Cmd+S or Save button writes changes to disk
    - Missing files show "not found" state
  </verify>
  <done>Agents page displays tabbed identity file editor with load, edit, save functionality for all 4 identity files</done>
</task>

</tasks>

<verification>
- Identity files load from ~/.config/tek/ on page open
- Editing a file and saving persists changes to disk (verify with `cat ~/.config/tek/SOUL.md`)
- Tab switching preserves unsaved edits (content stays in state)
- Save All saves all modified files at once
- Files that don't exist show an appropriate empty state
</verification>

<success_criteria>
Users can view, edit, and save all 4 agent identity files (SOUL.md, IDENTITY.md, USER.md, STYLE.md) through a tabbed editor interface. Changes persist to the filesystem via the Tauri FS plugin.
</success_criteria>

<output>
After completion, create `.planning/phases/17-desktop-frontend-tauri/17-04-SUMMARY.md`
</output>
