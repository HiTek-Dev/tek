---
phase: 06-agent-capabilities
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/core/src/skills/types.ts
  - packages/core/src/skills/loader.ts
  - packages/core/src/skills/index.ts
  - packages/core/src/index.ts
autonomous: true

must_haves:
  truths:
    - "Skills directory can be discovered and parsed from workspace and managed locations"
    - "SKILL.md files with YAML frontmatter are loaded into structured SkillMetadata objects"
    - "Workspace skills override managed skills with the same name"
    - "Invalid SKILL.md files are skipped silently without crashing"
  artifacts:
    - path: "packages/core/src/skills/types.ts"
      provides: "SkillMetadata, SkillTier, LoadedSkill types"
      exports: ["SkillMetadata", "SkillTier", "LoadedSkill"]
    - path: "packages/core/src/skills/loader.ts"
      provides: "discoverSkills function scanning directories for SKILL.md files"
      exports: ["discoverSkills"]
    - path: "packages/core/src/skills/index.ts"
      provides: "Barrel exports for skills module"
  key_links:
    - from: "packages/core/src/skills/loader.ts"
      to: "SKILL.md files"
      via: "gray-matter parsing of YAML frontmatter"
      pattern: "matter\\("
---

<objective>
Create the skills directory system with SKILL.md metadata parsing, supporting workspace and managed tiers.

Purpose: Enables the agent to discover and load filesystem-based skills that extend its capabilities, with a two-tier discovery system (workspace-local and global managed skills).
Output: Skills types, loader, and discovery system in @agentspace/core.
</objective>

<execution_context>
@/Users/hitekmedia/.claude/get-shit-done/workflows/execute-plan.md
@/Users/hitekmedia/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-agent-capabilities/06-RESEARCH.md

@packages/core/src/config/schema.ts
@packages/core/src/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skills types and loader</name>
  <files>
    packages/core/src/skills/types.ts
    packages/core/src/skills/loader.ts
    packages/core/src/skills/index.ts
    packages/core/src/index.ts
  </files>
  <action>
Install dependency: `pnpm --filter @agentspace/core add gray-matter`

Note: Do NOT add `glob` as a dependency. Use Node.js built-in `readdirSync` for directory scanning instead, which is sufficient for flat skill directory structures and avoids an unnecessary dependency.

1. Create `packages/core/src/skills/types.ts`:
   - `SkillTier` type: "workspace" | "managed".
   - `SkillMetadataSchema` using Zod: z.object with `name` (string), `description` (string), `tier` (enum workspace/managed, default "workspace"), `version` (string, optional), `tools` (string array, optional -- tool names this skill may use), `triggers` (string array, optional -- keywords/phrases that activate this skill).
   - `SkillMetadata` type inferred from schema.
   - `LoadedSkill` interface: `{ metadata: SkillMetadata, instructions: string, path: string, tier: SkillTier }`.

2. Create `packages/core/src/skills/loader.ts`:
   - `discoverSkills(dirs: { workspace?: string, managed?: string })` returning `LoadedSkill[]`:
     - For each provided directory, scan for `*/SKILL.md` (one level deep -- each skill is a subdirectory containing SKILL.md).
     - Use `readdirSync` with `{ withFileTypes: true }` to find subdirectories.
     - For each subdirectory, try to read `SKILL.md` file.
     - Parse YAML frontmatter with `gray-matter`. Validate metadata with `SkillMetadataSchema.safeParse`.
     - On parse failure, skip silently (log warning via createLogger if available).
     - Set `tier` field based on which directory the skill came from.
     - Workspace skills override managed skills with the same `metadata.name` (workspace takes precedence).
     - Return sorted by name for deterministic ordering.
   - `getSkillsDirs(config: { workspaceDir?: string, skillsDir?: string })` returning `{ workspace?: string, managed?: string }`:
     - Managed: `~/.config/agentspace/skills/` (always).
     - Workspace: `{workspaceDir}/.agentspace/skills/` if workspaceDir is set.
     - Custom: if `config.skillsDir` is set, use it as managed.
   - `formatSkillsForContext(skills: LoadedSkill[])` returning string:
     - Formats loaded skills into a section suitable for the context assembler.
     - Each skill: `## {name}\n{description}\n\n{instructions}` separated by newlines.
     - Returns empty string if no skills.

3. Create `packages/core/src/skills/index.ts` barrel exporting all types and functions.

4. Re-export skills module from `packages/core/src/index.ts`.
  </action>
  <verify>
    `pnpm --filter @agentspace/core build` passes. Verify exports: `SkillMetadata`, `LoadedSkill`, `discoverSkills`, `getSkillsDirs`, `formatSkillsForContext`.
  </verify>
  <done>Skills loader discovers SKILL.md files from workspace and managed directories, parses YAML frontmatter with gray-matter, validates with Zod, and returns structured LoadedSkill objects with workspace-over-managed precedence.</done>
</task>

</tasks>

<verification>
- `pnpm build` succeeds across all packages
- `packages/core/src/skills/loader.ts` exports discoverSkills, getSkillsDirs, formatSkillsForContext
- `packages/core/src/skills/types.ts` exports SkillMetadata, SkillTier, LoadedSkill, SkillMetadataSchema
- gray-matter is in @agentspace/core package.json dependencies
</verification>

<success_criteria>
Skills directory system is fully implemented: SKILL.md files can be discovered from workspace and managed directories, parsed with gray-matter, validated with Zod, and formatted for context injection. Workspace skills override managed skills with the same name.
</success_criteria>

<output>
After completion, create `.planning/phases/06-agent-capabilities/06-02-SUMMARY.md`
</output>
