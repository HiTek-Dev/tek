---
phase: 31-desktop-chat-app-rebuild
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/package.json
  - apps/desktop/tsconfig.json
  - apps/desktop/tsconfig.app.json
  - apps/desktop/tsconfig.node.json
  - apps/desktop/vite.config.ts
  - apps/desktop/index.html
  - apps/desktop/components.json
  - apps/desktop/src/main.tsx
  - apps/desktop/src/App.tsx
  - apps/desktop/src/index.css
  - apps/desktop/src/lib/utils.ts
  - apps/desktop/src/stores/app-store.ts
  - apps/desktop/src-tauri/Cargo.toml
  - apps/desktop/src-tauri/tauri.conf.json
  - apps/desktop/src-tauri/capabilities/default.json
  - apps/desktop/src-tauri/src/lib.rs
  - apps/desktop/src-tauri/src/main.rs
autonomous: true
requirements:
  - DESK-01
  - DESK-02

must_haves:
  truths:
    - "Desktop app project exists in apps/desktop/ with Tauri v2 + React + Vite + Tailwind v4"
    - "shadcn/ui is initialized with Button, Card, Badge, Dialog, ScrollArea, Separator, Tabs, Avatar, DropdownMenu, Tooltip, Textarea components"
    - "Zustand app store manages view state (landing/chat), gateway state, and selected agent"
    - "Tauri Rust backend registers websocket, fs, process, and shell plugins"
    - "App renders a root component with error boundary and view routing"
  artifacts:
    - path: "apps/desktop/package.json"
      provides: "Project dependencies and scripts"
      contains: "streamdown"
    - path: "apps/desktop/src/App.tsx"
      provides: "Root component with error boundary and view routing"
      min_lines: 15
    - path: "apps/desktop/src/stores/app-store.ts"
      provides: "Zustand global state store"
      exports: ["useAppStore"]
    - path: "apps/desktop/src-tauri/src/lib.rs"
      provides: "Tauri plugin registration"
      contains: "tauri_plugin_websocket"
    - path: "apps/desktop/src-tauri/tauri.conf.json"
      provides: "Tauri app configuration with CSP"
      contains: "connect-src"
  key_links:
    - from: "apps/desktop/src/main.tsx"
      to: "apps/desktop/src/App.tsx"
      via: "React root render"
      pattern: "createRoot.*App"
    - from: "apps/desktop/src/App.tsx"
      to: "apps/desktop/src/stores/app-store.ts"
      via: "Zustand store hook"
      pattern: "useAppStore"
---

<objective>
Scaffold the Tauri v2 desktop app from scratch in apps/desktop/ with React 19, Vite 6, Tailwind CSS v4, and shadcn/ui component library. Configure Rust backend with WebSocket, filesystem, process, and shell plugins. Set up Zustand app store and root component with error boundary.

Purpose: Establish the complete project foundation that all subsequent plans build upon -- without this scaffold, no desktop code can be written or tested.
Output: A bootable Tauri desktop app with all dependencies installed, shadcn/ui components available, and Zustand state management ready.
</objective>

<execution_context>
@/Users/drew-mini/.claude/get-shit-done/workflows/execute-plan.md
@/Users/drew-mini/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/31-desktop-chat-app-rebuild/31-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tauri v2 project with React + Vite + Tailwind v4 + shadcn/ui</name>
  <files>
    apps/desktop/package.json
    apps/desktop/tsconfig.json
    apps/desktop/tsconfig.app.json
    apps/desktop/tsconfig.node.json
    apps/desktop/vite.config.ts
    apps/desktop/index.html
    apps/desktop/components.json
    apps/desktop/src/main.tsx
    apps/desktop/src/index.css
    apps/desktop/src/lib/utils.ts
  </files>
  <action>
    Create the apps/desktop/ directory structure from scratch.

    1. **package.json**: Create with name "@tek/desktop", private:true, type:"module". Dependencies:
       - react, react-dom, zustand, @tauri-apps/api, @tauri-apps/plugin-websocket, @tauri-apps/plugin-fs, @tauri-apps/plugin-process, @tauri-apps/plugin-shell, react-error-boundary, @fontsource/inter, streamdown, @streamdown/code, lucide-react, clsx, tailwind-merge, class-variance-authority
       - devDependencies: @vitejs/plugin-react, @tailwindcss/vite, tailwindcss, typescript, @types/react, @types/react-dom, @types/node, @tauri-apps/cli, vite

    2. **TypeScript configs**: Create tsconfig.json (references to app and node configs), tsconfig.app.json (for src/ with React JSX, strict mode, paths alias "@/*" -> "./src/*"), tsconfig.node.json (for vite.config.ts).

    3. **vite.config.ts**: Configure with @vitejs/plugin-react and @tailwindcss/vite plugins. Set server host to false (Tauri default), clearScreen to false. Set resolve alias "@" -> "./src".

    4. **index.html**: Minimal HTML with div#root, script src="/src/main.tsx" type="module".

    5. **src/index.css**: Tailwind v4 CSS-first config. Import tailwindcss. Define design tokens as CSS custom properties matching the existing dark theme from old app:
       - --background: dark bg (e.g., 224 71% 4%)
       - --foreground: light text
       - --card, --card-foreground, --primary, --secondary, --muted, --accent, --destructive, --border, --input, --ring
       - --radius: 0.5rem
       - Import @fontsource/inter
       - Apply font-family Inter to body with antialiased rendering

    6. **src/lib/utils.ts**: Create the cn() utility function using clsx + tailwind-merge (standard shadcn/ui pattern).

    7. **src/main.tsx**: Create React 19 entry point with createRoot rendering App component. Import index.css.

    8. **Initialize shadcn/ui**: Create components.json pointing to the correct paths (src/components/ui, src/lib/utils.ts, Tailwind CSS vars enabled, "@" alias). Then run shadcn CLI to add components: button, card, badge, dialog, scroll-area, separator, tabs, avatar, dropdown-menu, tooltip, textarea.

    Run `pnpm install` from the monorepo root after creating package.json.
    Run `pnpm dlx shadcn@latest init` then `pnpm dlx shadcn@latest add button card badge dialog scroll-area separator tabs avatar dropdown-menu tooltip textarea` from apps/desktop/.
  </action>
  <verify>
    - `ls apps/desktop/package.json` exists
    - `ls apps/desktop/src/components/ui/button.tsx` exists (shadcn components installed)
    - `ls apps/desktop/src/lib/utils.ts` exists
    - `pnpm ls --filter @tek/desktop react zustand streamdown` shows dependencies
  </verify>
  <done>
    apps/desktop/ contains a complete frontend project scaffold with all dependencies installed, shadcn/ui components generated, Tailwind v4 configured with dark theme tokens, and TypeScript paths alias working.
  </done>
</task>

<task type="auto">
  <name>Task 2: Configure Tauri Rust backend, app store, and root component</name>
  <files>
    apps/desktop/src-tauri/Cargo.toml
    apps/desktop/src-tauri/tauri.conf.json
    apps/desktop/src-tauri/capabilities/default.json
    apps/desktop/src-tauri/src/lib.rs
    apps/desktop/src-tauri/src/main.rs
    apps/desktop/src/App.tsx
    apps/desktop/src/stores/app-store.ts
  </files>
  <action>
    1. **src-tauri/Cargo.toml**: Create with package name "tek-desktop", edition 2021. Dependencies:
       - tauri (features: []) with build features
       - tauri-plugin-websocket
       - tauri-plugin-fs
       - tauri-plugin-process
       - tauri-plugin-shell (features: ["open"])
       - serde, serde_json (features: ["derive"])
       Build dependencies: tauri-build

    2. **src-tauri/tauri.conf.json**: Configure per research:
       - productName: "Tek", version: "0.2.0", identifier: "com.tek.desktop"
       - build: beforeDevCommand "pnpm dev", beforeBuildCommand "pnpm build", devUrl "http://localhost:5173", frontendDist "../dist"
       - app.windows: title "Tek", width 1000, height 700, minWidth 600, minHeight 400
       - app.security.csp: "default-src 'self'; connect-src 'self' ws://127.0.0.1:* http://127.0.0.1:*; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:"

    3. **src-tauri/capabilities/default.json**: Grant permissions for websocket:default, fs:default (scope read access to $HOME/.config/tek/), process:default, shell:default.

    4. **src-tauri/src/lib.rs**: Register all four Tauri plugins (websocket, fs, process, shell). Standard tauri::Builder::default() pattern.

    5. **src-tauri/src/main.rs**: Standard Tauri main entry with #![cfg_attr(not(debug_assertions), windows_subsystem = "windows")] and call to lib::run().

    6. **src/stores/app-store.ts**: Create Zustand store with:
       - currentView: 'landing' | 'chat' (default 'landing')
       - setCurrentView(view)
       - gateway: { status: 'unknown' | 'running' | 'stopped', port: number | null, pid: number | null, startedAt: string | null }
       - setGateway(info | null) -- sets status to running/stopped based on info presence
       - selectedAgentId: string | null
       - setSelectedAgentId(id)
       - sessionId: string | null
       - setSessionId(id)

    7. **src/App.tsx**: Create root component:
       - Import ErrorBoundary from react-error-boundary
       - Read currentView from useAppStore
       - Render ErrorBoundary wrapping view switch (landing placeholder div vs chat placeholder div for now)
       - Create simple ErrorFallback component inline showing error message and retry button
  </action>
  <verify>
    - `ls apps/desktop/src-tauri/Cargo.toml` exists
    - `ls apps/desktop/src-tauri/tauri.conf.json` exists
    - `grep "tauri_plugin_websocket" apps/desktop/src-tauri/src/lib.rs` matches
    - `grep "useAppStore" apps/desktop/src/stores/app-store.ts` matches
    - `grep "ErrorBoundary" apps/desktop/src/App.tsx` matches
  </verify>
  <done>
    Tauri Rust backend is configured with all four plugins registered. CSP allows WebSocket and HTTP connections to localhost. Zustand app store manages view, gateway, agent, and session state. Root App component renders with error boundary and view routing (placeholder views for now).
  </done>
</task>

</tasks>

<verification>
- apps/desktop/ directory exists with complete project structure
- package.json has all required dependencies
- shadcn/ui components are generated in src/components/ui/
- Tauri Rust backend compiles (cargo check in src-tauri/)
- Zustand store exports useAppStore with view, gateway, agent state
- App.tsx renders with ErrorBoundary wrapper
- CSP in tauri.conf.json allows ws://127.0.0.1:* connections
</verification>

<success_criteria>
The desktop app project scaffold is complete with all dependencies, configurations, and foundational code in place. Subsequent plans can immediately start building views and hooks without any setup work.
</success_criteria>

<output>
After completion, create `.planning/phases/31-desktop-chat-app-rebuild/31-01-SUMMARY.md`
</output>
